# ADR 003 - Uso de Redis para Control de Stock y Caching

**Estado:** Aprobado

## Contexto
El sistema YAGNI debe gestionar una alta cantidad de operaciones concurrentes, incluidas las solicitudes de pedidos, actualizaciones de stock y notificaciones entre servicios como logística, cocinas y refrigeradores inteligentes. Además, el sistema debe ser capaz de manejar la alta demanda de pedidos concurrentes (hasta 8000 por segundo en modo sobrecargado), manteniendo tiempos de respuesta bajos y asegurando la integridad del stock. Se requiere una solución rápida y eficiente para controlar el stock en tiempo real y proporcionar caching de datos frecuentemente utilizados.

## Decisión
Se ha decidido utilizar Redis para controlar el stock en tiempo real y, cachear para cada pedido cuáles son los refrigeradores que contienen sus productos. Redis, al ser un almacén de datos en memoria, permite operaciones rápidas, ideal para los requisitos de alta concurrencia y bajo tiempo de respuesta del sistema.

## Atributos de Calidad Satisfechos

- **Performance:** Redis proporciona respuestas en milisegundos para operaciones de lectura y escritura, asegurando que los tiempos de respuesta para las solicitudes y actualizaciones de stock se mantengan por debajo de los límites requeridos.
- **Escalabilidad:** Redis es capaz de manejar miles de solicitudes por segundo, lo que lo hace adecuado para los niveles de concurrencia esperados en el sistema YAGNI.
- **Disponibilidad:** Redis puede configurarse con alta disponibilidad, con soporte para réplicas y clustering, asegurando que el sistema pueda recuperarse rápidamente de fallos sin afectar el servicio.
- **Seguridad:** El control de stock en tiempo real mediante Redis asegura la integridad de los datos entre las diferentes partes del sistema, garantizando que el stock disponible sea preciso y actualizado.

## Ventajas

- **Alto rendimiento:** Redis permite la rápida lectura y escritura de datos en memoria, lo que es crucial para mantener tiempos de respuesta bajos en un sistema con alta concurrencia.
- **Caching eficiente:** Los datos que se consultan con frecuencia, como el stock disponible y estados de pedidos, pueden ser almacenados en caché para evitar consultas repetitivas a la base de datos, mejorando el rendimiento general.
- **Fácil de integrar:** Redis es compatible con múltiples lenguajes y frameworks, facilitando su integración con la infraestructura existente en Node.js, Express y Sequelize.

## Desventajas

- **Complejidad en la configuración:** Configurar Redis para alta disponibilidad, clustering y replicación puede requerir un mayor esfuerzo y experiencia técnica.
- **Pérdida de datos en caso de fallo:** Aunque Redis es extremadamente rápido, en escenarios de caída repentina del sistema, podrían perderse datos que no hayan sido persistidos si no se configura correctamente la durabilidad.
- **Dependencia de la red:** El uso de Redis como servicio en la nube puede añadir latencia en caso de problemas de conectividad, afectando el rendimiento de las operaciones de lectura/escritura.

# ADR 010 - Uso del patrón Circuit Breaker para la Pasarela de Pago

**Estado:** Aprobado

## Contexto

YAGNI debe interactuar con una pasarela de pago externa para procesar las transacciones de los clientes. La pasarela puede tener variabilidad en su disponibilidad, presentando tiempos de respuesta altos o errores intermitentes que afectarían la experiencia del usuario final si no se controlan. Para mantener la **disponibilidad** del sistema y evitar que estos problemas impacten en la calidad del servicio, se decidió implementar un patrón de Circuit Breaker usando la librería **Opossum**.

## Decisión

Implementar un **Circuit Breaker** con la librería Opossum en la integración con la pasarela de pago. 
Este patrón nos permitirá:
- controlar el flujo de solicitudes hacia la pasarela de pago.
- detectar fallos y tiempos de espera largos.
- cortar temporalmente las solicitudes al servicio externo en caso de fallos continuos, permitiendo a YAGNI manejar mejor los tiempos de inactividad de la pasarela.

#### Configuración Clave de Opossum

Se configurará con:

- **Timeout**: Limitará el tiempo de espera de respuesta de la pasarela.
- **Threshold**: Definirá el porcentaje de fallos permitidos antes de abrir el Circuit Breaker.
- **Reset Timeout**: Tiempo de espera antes de que el Circuit Breaker permita nuevos intentos de conexión.

## Atributos de Calidad Satisfechos

- **Disponibilidad**: El Circuit Breaker minimizará los tiempos de inactividad para los clientes al desconectar temporalmente la pasarela de pago cuando esta no responda adecuadamente.
- **Seguridad**: Al detener temporalmente el flujo hacia la pasarela de pago en caso de errores, el sistema evita bloqueos y reduce el impacto de dependencias externas inestables.
- **Performance**: Reducirá los tiempos de espera para el usuario final al evitar llamadas prolongadas a un servicio no disponible.

## Ventajas

- **Mejora la experiencia del usuario** al prevenir tiempos de espera largos.
- **Reducción de sobrecarga en la API Gateway** al no enviar múltiples solicitudes fallidas a la pasarela.
- **Monitoreo de la estabilidad** de la pasarela de pago mediante métricas de estado y fallos del Circuit Breaker.

## Desventajas

- **Mayor complejidad en la implementación** y en la configuración inicial de Opossum.
- **Posible bloqueo temporal** de la pasarela de pago, lo cual podría limitar temporalmente las transacciones cuando el Circuit Breaker se activa en exceso.

